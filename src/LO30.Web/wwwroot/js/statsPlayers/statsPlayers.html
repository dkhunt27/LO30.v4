<div>
  <lo30-page-header></lo30-page-header>

  <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
      <div class="col-lg-12">
        <div class="m-t-lg">

          <div class="ibox float-e-margins">
            <div class="ibox-title">
              <h5>Individual Statistics</h5>
              <div class="ibox-tools">
              </div>
            </div>
            <div class="ibox-content">
              <div class="row">
                <div class="col-xs-12">
                  <div class="input-group">
                    <div class="input-group-addon">
                      <span class="glyphicon glyphicon-search"></span>
                    </div>
                    <input class="form-control input-block-level" id="search-text" name="searchText" ng-model="searchText" type="text" focus="" required="" placeholder="SEARCH ANY FIELD">
                    <div class="input-group-addon">
                      <span class="glyphicon glyphicon-remove" ng-click="removeSearch()"></span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row" ng-if="vm.screenSizeIsMobile">
                <well>
                  <form class="form-horizontal">
                    <div class="form-group">
                      <div class="col-xs-1"></div>
                      <label for="teamDropdown" class="col-xs-2 control-label">Team:</label>
                      <div id="teamDropdown" class="col-xs-3 btn-group" uib-dropdown dropdown-append-to-body>
                        <button id="btn-append-to-body" type="button" class="btn btn-primary" uib-dropdown-toggle>
                          {{vm.selectedTeam ? vm.selectedTeam : "Any"}} <span class="caret"></span>
                        </button>
                        <ul uib-dropdown-menu>
                          <li id="filterByTeam{{$index}}" data-ng-repeat="team in vm.teamsToDisplay" ng-click="filterByTeam(team)">
                            {{team.teamNameToDisplay}}
                          </li>
                        </ul>
                      </div>
                      <label for="subDropdown" class="col-xs-2 control-label">Sub:</label>
                      <div id="subDropdown" class="col-xs-3 btn-group" uib-dropdown dropdown-append-to-body>
                        <button id="btn-append-to-body" type="button" class="btn btn-success" uib-dropdown-toggle>
                          {{vm.selectedSub ? vm.selectedSub : "Any"}} <span class="caret"></span>
                        </button>
                        <ul uib-dropdown-menu>
                          <li data-ng-repeat="sub in subs" ng-click="filterBySub(sub)">
                            {{sub}}
                          </li>
                        </ul>
                      </div>
                      <div class="col-xs-1"></div>
                    </div>
                    <div ng-if="vm.selectedType==='skater'" class="form-group">
                      <div class="col-xs-1"></div>
                      <label for="lineDropdown" class="col-xs-2 control-label">Line:</label>
                      <div id="lineDropdown" class="col-xs-3 btn-group" uib-dropdown dropdown-append-to-body>
                        <button id="btn-append-to-body" type="button" class="btn btn-warning" uib-dropdown-toggle ng-disabled="vm.selectedType==='goalie'">
                          {{vm.selectedLine ? vm.selectedLine : "Any"}} <span class="caret"></span>
                        </button>
                        <ul uib-dropdown-menu>
                          <li data-ng-repeat="line in lines" ng-click="filterByLine(line)">
                            {{line}}
                          </li>
                        </ul>
                      </div>
                      <label for="positionDropdown" class="col-xs-2 control-label">Pos:</label>
                      <div id="positionDropdown" class="col-xs-3 btn-group" uib-dropdown dropdown-append-to-body>
                        <button id="btn-append-to-body" type="button" class="btn btn-danger" uib-dropdown-toggle ng-disabled="vm.selectedType==='goalie'">
                          {{vm.selectedPosition ? vm.selectedPosition : "Any"}} <span class="caret"></span>
                        </button>
                        <ul uib-dropdown-menu>
                          <li data-ng-repeat="position in positions" ng-click="filterByPosition(position)">
                            {{position}}
                          </li>
                        </ul>
                      </div>
                      <div class="col-xs-1"></div>
                    </div>
                  </form>
                </well>
              </div>
              <div class="row" ng-if="!vm.screenSizeIsMobile">
                <div>
                  <table>
                    <tr>
                      <td align="center">
                        <div class="col-xs-12">
                          <div class="btn-group btn-group-xs btn-group-justified">
                            <div class="btn-group">
                              <button type="button" class="btn btn-success btn-lo30-disabled" disabled="disabled">Teams:</button>
                            </div>
                            <div data-ng-repeat="team in vm.teams" class="btn-group">
                              <button id="filterByTeam{{$index}}" type="button" class="btn" ng-click="filterByTeam(team)"
                                      ng-class="{'btn-default':team.teamNameToDisplay !== vm.selectedTeam, 'btn-success':team.teamNameToDisplay === vm.selectedTeam}">
                                {{team.teamNameToDisplay}}
                              </button>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
                <div>
                  <table>
                    <tr>
                      <td align="center">
                        <div class="col-xs-12">
                          <div class="btn-group btn-group-xs btn-group-justified">
                            <div class="btn-group">
                              <button type="button" class="btn btn-danger btn-lo30-disabled" disabled="disabled">Pos:</button>
                            </div>
                            <div data-ng-repeat="position in vm.positions" class="btn-group">
                              <button type="button" class="btn" ng-click="filterByPosition(position)"
                                      ng-class="{'btn-default':position !== vm.selectedPosition, 'btn-danger':position === vm.selectedPosition}" ng-disabled="vm.selectedType==='goalie'">
                                {{position}}
                              </button>
                            </div>
                          </div>
                        </div>
                      </td>
                      <td align="center">
                        <div class="col-xs-12">
                          <div class="btn-group btn-group-xs btn-group-justified">
                            <div class="btn-group">
                              <button type="button" class="btn btn-warning btn-lo30-disabled" disabled="disabled">Line:</button>
                            </div>
                            <div data-ng-repeat="line in vm.lines" class="btn-group">
                              <button type="button" class="btn" ng-click="filterByLine(line)"
                                      ng-class="{'btn-default':line !== vm.selectedLine, 'btn-warning':line === vm.selectedLine}" ng-disabled="vm.selectedType==='goalie'">
                                {{line}}
                              </button>
                            </div>
                          </div>
                        </div>
                      </td>
                      <td align="center">
                        <div class="col-xs-12">
                          <div class="btn-group btn-group-xs btn-group-justified">
                            <div class="btn-group">
                              <button type="button" class="btn btn-primary btn-lo30-disabled" disabled="disabled">Subs:</button>
                            </div>
                            <div data-ng-repeat="sub in vm.subs" class="btn-group">
                              <button type="button" class="btn" ng-click="filterBySub(sub)"
                                      ng-class="{'btn-default':sub !== vm.selectedSub, 'btn-primary':sub === vm.selectedSub}">
                                {{sub}}
                              </button>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>

              <br />
              <div>
                <table id="dtSkatersStats" class="table table-striped table-bordered table-hover" style="width: 100%;">
                  <thead>
                    <tr>
                      <th class="text-left">Rank</th>
                      <th class="text-left">Player</th>
                      <th class="text-left">GP</th>
                      <th class="text-left">G</th>
                      <th class="text-left">A</th>
                      <th class="text-left">P</th>
                      <th class="text-left">PIM</th>
                      <th class="text-left">PPG</th>
                      <th class="text-left">SHG</th>
                      <th class="text-left">GWG</th>
                      <th class="text-left">Team</th>
                      <th class="text-left">Pos</th>
                      <th class="text-left">Line</th>
                      <th class="text-left">Sub</th>
                    </tr>
                  </thead>
                  <tfoot>
                    <tr>
                      <th class="text-left">Rank</th>
                      <th class="text-left">Player</th>
                      <th class="text-left">GP</th>
                      <th class="text-left">G</th>
                      <th class="text-left">A</th>
                      <th class="text-left">P</th>
                      <th class="text-left">PIM</th>
                      <th class="text-left">PPG</th>
                      <th class="text-left">SHG</th>
                      <th class="text-left">GWG</th>
                      <th class="text-left">Team</th>
                      <th class="text-left">Pos</th>
                      <th class="text-left">Line</th>
                      <th class="text-left">Sub</th>
                    </tr>
                  </tfoot>
                </table>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function () {

        var buildPlayerName = function (playerNameFirst, playerNameLast, playerNameSuffix, limit) {
          var playerName = "";

          if (!playerNameSuffix) {
            if (playerNameFirst.length + playerNameLast.length + 1 <= limit) {
              playerName = playerNameFirst + " " + playerNameLast;
            } else if (3 + playerNameLast.length + 1 <= limit) {
              playerName = playerNameFirst.substr(0, 1) + ". " + playerNameLast;

              if (playerName.Length > limit) {
                playerName = playerName.substr(0, limit - 1) + ".";
              }
            }
          } else {
            if (playerNameFirst.length + playerNameLast.length + playerNameSuffix.length + 3 <= limit) {
              playerName = playerNameFirst + " " + playerNameLast + ", " + playerNameSuffix;
            }
            else if (3 + playerNameLast.length + playerNameSuffix.length + 2 <= limit) {
              playerName = playerNameFirst.substr(0, 1) + ". " + playerNameLast + ", " + playerNameSuffix;
            } else {
              playerName = buildPlayerName(playerNameFirst, playerNameLast, string.Empty, limit);
            }
          }

          return playerName;
        }

        var buildPlayerNameCode = function (playerNameFirst, playerNameLast, playerNameSuffix) {
          return buildPlayerName(playerNameFirst, playerNameLast, playerNameSuffix, 15);
        }

        var buildPlayerNameShort = function (playerNameFirst, playerNameLast, playerNameSuffix) {
          return buildPlayerName(playerNameFirst, playerNameLast, playerNameSuffix, 25);
        }

        var buildPlayerNameLong = function (playerNameFirst, playerNameLast, playerNameSuffix) {
          return buildPlayerName(playerNameFirst, playerNameLast, playerNameSuffix, 50);
        }

        var width = $(window).width();

        var table = $('#dtSkatersStats').DataTable({
          // dom: '<"html5buttons"B>lTfgitp',
          "dom": "<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'html5buttons'B>>><'row'<'col-sm-12'rt>><'row'<'col-sm-12'p>>",
          //"sDom": '<"row view-filter"<"col-sm-12"<"clearfix">>>t<"row view-pager"<"col-sm-12"<"text-center"ip>>>',
          "buttons": [
            "colvis", "copyHtml5", "excelHtml5", { extend: 'pdfHtml5', orientation: 'landscape', pageSize: 'letter' }
          ],
          "paging": true,
          "page-length": 25,
          "order": [[5, "desc"]],
          "info": true,
          "responsive": true,
          "columns": [
            {
              "data": null, // can be null or undefined
              "defaultContent": ""
            },
            {
              "data": "playerNameToDisplay",
              "render": function (data, type, row) {
                var playerName;
                if (width <= 800) {
                  playerName = buildPlayerNameCode(row.playerFirstName, row.playerLastName, row.playerSuffix);
                } else if (width <= 1200) {
                  playerName = buildPlayerNameShort(row.playerFirstName, row.playerLastName, row.playerSuffix);
                } else {
                  playerName = buildPlayerNameLong(row.playerFirstName, row.playerLastName, row.playerSuffix);;
                }
                return '<a href="/#/r/profiles/players/' + row.playerId + '/playertypes/skater?tab=season">' + playerName + '</a>';
              }
            },
            { "data": "games" },
            { "data": "goals" },
            { "data": "assists" },
            { "data": "points" },
            { "data": "penaltyMinutes" },
            { "data": "powerPlayGoals" },
            { "data": "shortHandedGoals" },
            { "data": "gameWinningGoals" },
            {
              "data": "teamNameToDisplay",
              "render": function (data, type, row) {
                var result = row.teamNameShort;
                if (width <= 800) {
                  result = row.teamCode;
                } else if (width <= 1200) {
                  result = row.teamNameShort;
                }
                return result;
              }
            },
            { "data": "position" },
            { "data": "line" },
            {
              "data": "sub",
              "render": function (data, type, row) {
                if (data) {
                  return "Y";
                } else {
                  return "N";
                }
              }
            },
            {
              "data": "teamCode",
              "visible": false
            },
            {
              "data": "teamNameShort",
              "visible": false
            },
            {
              "data": "teamNameLong",
              "visible": false
            },
            {
              "data": "playerFirstName",
              "visible": false
            },
            {
              "data": "playerLastName",
              "visible": false
            },
            {
              "data": "playerSuffix",
              "visible": false
            }
          ],
          "ajax": {
            "url": "../api/playerstatteams/seasons/0/seasonTypes/0?key=1",
            "type": "GET",
            "dataSrc": ""
          }
        });

        table.on('order.dt search.dt', function () {
          table.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
            cell.innerHTML = i + 1;
          });
        }).draw();

        // HACK...add this to the window so the angular code can access this function
        // couldn't get the angular datatable to sort as expected
        dtSkatersStats = table;
      });
    </script>
  </div>
</div>

